<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Cupid</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800">
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="stylesheet" href="assets/styles/main.css">
    <link rel="stylesheet" href="assets/styles/components.css">
    <link rel="stylesheet" href="assets/styles/utilities.css">
</head>

<body class="bg-brutalist-dark-pink" style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'>
    <div class="relative flex size-full min-h-screen flex-col overflow-x-hidden group/design-root">
        <div class="layout-container flex h-full grow flex-col">
            
            <!-- Header -->
            <header class="site-header">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between py-4">
                        <!-- Logo -->
                        <div class="flex items-center gap-3">
                            <h1 class="text-2xl sm:text-3xl font-black leading-tight tracking-tighter text-black">
                                <a href="home.html" class="hover:text-[var(--dark-pink-800)] transition-colors">Cupid</a>
                            </h1>
                        </div>
                        
                        <!-- Desktop Navigation -->
                        <nav class="hidden md:flex items-center gap-6">
                            <a class="nav-link" href="discover.html">Home</a>
                            <a class="nav-link" href="swipe.html">Swipe</a>
                            <a class="nav-link" href="messages.html">Messages</a>
                            <a class="nav-link" href="profile.html">Profile</a>
                            <button id="logoutBtn" class="btn-secondary">Logout</button>
                        </nav>
                        <!-- Mobile Menu Button -->
                        <div class="md:hidden">
                            <button id="mobile-menu-toggle" class="p-2 text-[var(--dark-pink-800)] hover:text-black" aria-label="Toggle menu">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Mobile Menu -->
                    <nav id="mobile-menu" class="md:hidden hidden border-t-2 border-black py-4">
                        <div class="flex flex-col gap-4 px-4">
                            <a href="login.html" class="btn-secondary inline-block text-center">Login</a>
                            <a href="signup.html" class="btn-primary inline-block text-center">Sign Up</a>
                        </div>
                    </nav>
                </div>
            </header>

            <!-- Main Content -->
            <main class="flex-1">
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                    <div class="max-w-4xl mx-auto">
                        
                        <!-- Page Header -->
                        <div class="text-center mb-8">
                            <h2 class="text-3xl sm:text-4xl font-black text-black mb-4">
                                Account <span class="text-[var(--dark-pink-500)]">Settings</span>
                            </h2>
                            <p class="text-lg text-[var(--dark-pink-800)]">
                                Manage your preferences and account settings
                            </p>
                        </div>

                        <!-- Settings Sections -->
                        <div class="space-y-8">
                            
                            <!-- Notification Settings -->
                            <div class="card p-6">
                                <h3 class="text-xl font-bold text-black mb-6">Notification Settings</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">New Messages</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Get notified when you receive new messages</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="notifications_messages" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">New Matches</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Get notified when you have new matches</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="notifications_matches" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">Profile Views</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Get notified when someone views your profile</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="notifications_profile_views">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">New Likes</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Get notified when someone likes your profile</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="notifications_likes" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">Email Notifications</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Receive notifications via email</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="notifications_email" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Privacy Settings -->
                            <div class="card p-6">
                                <h3 class="text-xl font-bold text-black mb-6">Privacy Settings</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">Show Distance</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Display your distance to other users</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="show_distance" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">Show Age</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Display your age on your profile</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer" data-setting="show_age" checked>
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                    
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <label class="text-black font-semibold">Recently Active</label>
                                            <p class="text-sm text-[var(--dark-pink-800)]">Show when you were last active</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-[var(--dark-pink-300)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--dark-pink-500)]"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Discovery Settings -->
                            <div class="card p-6">
                                <h3 class="text-xl font-bold text-black mb-6">Discovery Settings</h3>
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-black font-semibold mb-2">Maximum Distance</label>
                                        <div class="flex items-center gap-4">
                                            <input type="range" min="1" max="100" value="25" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" id="distanceSlider">
                                            <span class="text-[var(--dark-pink-800)] font-semibold" id="distanceValue">25 miles</span>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-black font-semibold mb-2">Age Range</label>
                                        <div class="flex items-center gap-4">
                                            <div class="flex-1">
                                                <label class="block text-sm text-[var(--dark-pink-800)] mb-1">Min Age</label>
                                                <input type="number" min="18" max="100" value="22" class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]">
                                            </div>
                                            <div class="flex-1">
                                                <label class="block text-sm text-[var(--dark-pink-800)] mb-1">Max Age</label>
                                                <input type="number" min="18" max="100" value="35" class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-black font-semibold mb-2">Show Me</label>
                                        <select class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]">
                                            <option>Everyone</option>
                                            <option>Men</option>
                                            <option>Women</option>
                                            <option>Non-binary</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Account Management -->
                            <div class="card p-6">
                                <h3 class="text-xl font-bold text-black mb-6">Account Management</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-black font-semibold mb-2">Email Address</label>
                                        <input type="email" value="john.doe@example.com" class="w-full px-4 py-3 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-black font-semibold mb-2">Phone Number</label>
                                        <input type="tel" value="+1 (555) 123-4567" class="w-full px-4 py-3 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]">
                                    </div>
                                    
                                    <div class="flex gap-4 pt-4">
                                        <button class="btn-primary">Change Password</button>
                                        <button class="btn-secondary">Verify Phone</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Danger Zone -->
                            <div class="card p-6 border-red-500">
                                <h3 class="text-xl font-bold text-red-600 mb-6">Danger Zone</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg">
                                        <div>
                                            <h4 class="text-black font-semibold">Pause Account</h4>
                                            <p class="text-sm text-red-600">Temporarily hide your profile from discovery</p>
                                        </div>
                                        <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded hover:bg-red-700 transition-colors">Pause</button>
                                    </div>
                                    
                                    <div class="flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded-lg">
                                        <div>
                                            <h4 class="text-black font-semibold">Delete Account</h4>
                                            <p class="text-sm text-red-600">Permanently delete your account and all data</p>
                                        </div>
                                        <button class="px-4 py-2 bg-red-600 text-white font-semibold rounded hover:bg-red-700 transition-colors">Delete</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Save Changes -->
                            <div class="text-center">
                                <button class="btn-primary text-lg px-8 py-3">Save All Changes</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="text-center py-6 border-t-2 border-black bg-[var(--dark-pink-200)] bg-opacity-50">
                <div class="container mx-auto px-4 sm:px-6">
                    <p class="text-sm text-[var(--dark-pink-800)]">
                        © 2025 Cupid. All rights reserved. Find love, authentically.
                    </p>
                </div>
            </footer>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="assets/js/main.js"></script>
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Distance slider
        const distanceSlider = document.getElementById('distanceSlider');
        const distanceValue = document.getElementById('distanceValue');

        distanceSlider.addEventListener('input', function() {
            distanceValue.textContent = this.value + ' miles';
        });

        // Load current settings
        async function loadSettings() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = 'login.html';
                    return;
                }

                const response = await fetch('/api/users/settings', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const settings = data.settings;
                    
                    // Update UI with current settings
                    document.getElementById('distanceSlider').value = settings.max_distance || 50;
                    document.getElementById('distanceValue').textContent = (settings.max_distance || 50) + ' miles';
                    
                    // Update toggle switches
                    const toggles = {
                        'notifications_matches': settings.notifications_matches,
                        'notifications_messages': settings.notifications_messages,
                        'notifications_likes': settings.notifications_likes,
                        'notifications_profile_views': settings.notifications_profile_views,
                        'notifications_email': settings.notifications_email,
                        'show_distance': settings.show_distance,
                        'show_age': settings.show_age
                    };

                    Object.entries(toggles).forEach(([key, value]) => {
                        const checkbox = document.querySelector(`[data-setting="${key}"]`);
                        if (checkbox) {
                            checkbox.checked = value;
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Save settings
        async function saveSettings() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = 'login.html';
                    return;
                }

                const settings = {
                    max_distance: parseInt(document.getElementById('distanceSlider').value),
                    notifications_matches: document.querySelector('[data-setting="notifications_matches"]')?.checked,
                    notifications_messages: document.querySelector('[data-setting="notifications_messages"]')?.checked,
                    notifications_likes: document.querySelector('[data-setting="notifications_likes"]')?.checked,
                    notifications_profile_views: document.querySelector('[data-setting="notifications_profile_views"]')?.checked,
                    notifications_email: document.querySelector('[data-setting="notifications_email"]')?.checked,
                    show_distance: document.querySelector('[data-setting="show_distance"]')?.checked,
                    show_age: document.querySelector('[data-setting="show_age"]')?.checked
                };

                const response = await fetch('/api/users/settings', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    alert('Settings saved successfully!');
                } else {
                    const error = await response.json();
                    alert('Error saving settings: ' + error.error);
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Failed to save settings. Please try again.');
            }
        }

        // Change password
        async function changePassword() {
            const currentPassword = prompt('Enter your current password:');
            if (!currentPassword) return;

            const newPassword = prompt('Enter your new password (minimum 6 characters):');
            if (!newPassword || newPassword.length < 6) {
                alert('New password must be at least 6 characters long');
                return;
            }

            const confirmPassword = prompt('Confirm your new password:');
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/change-password', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                if (response.ok) {
                    alert('Password changed successfully!');
                } else {
                    const error = await response.json();
                    alert('Error changing password: ' + error.error);
                }
            } catch (error) {
                console.error('Error changing password:', error);
                alert('Failed to change password. Please try again.');
            }
        }

        // Pause account
        async function pauseAccount() {
            if (!confirm('Are you sure you want to pause your account? You can reactivate it at any time.')) {
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/pause-account', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    alert('Account paused successfully');
                } else {
                    const error = await response.json();
                    alert('Error pausing account: ' + error.error);
                }
            } catch (error) {
                console.error('Error pausing account:', error);
                alert('Failed to pause account. Please try again.');
            }
        }

        // Delete account
        async function deleteAccount() {
            if (!confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                return;
            }

            if (!confirm('This will permanently delete all your data. Are you absolutely sure?')) {
                return;
            }

            const confirmPassword = prompt('Enter your password to confirm account deletion:');
            if (!confirmPassword) return;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/users/delete-account', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        confirmPassword
                    })
                });

                if (response.ok) {
                    alert('Account deleted successfully');
                    localStorage.removeItem('token');
                    sessionStorage.removeItem('token');
                    window.location.href = 'login.html';
                } else {
                    const error = await response.json();
                    alert('Error deleting account: ' + error.error);
                }
            } catch (error) {
                console.error('Error deleting account:', error);
                alert('Failed to delete account. Please try again.');
            }
        }

        // Load settings on page load
        loadSettings();

        // Save changes button
        document.querySelector('.btn-primary').addEventListener('click', function() {
            if (this.textContent.includes('Save All Changes')) {
                saveSettings();
            } else if (this.textContent.includes('Change Password')) {
                changePassword();
            }
        });

        // Danger zone buttons
        document.querySelectorAll('.bg-red-600').forEach(button => {
            button.addEventListener('click', function() {
                if (this.textContent.includes('Pause')) {
                    pauseAccount();
                } else if (this.textContent.includes('Delete')) {
                    deleteAccount();
                }
            });
        });        // Toggle switches
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                // Auto-save functionality would be implemented here
                console.log('Setting changed:', this.closest('.flex').querySelector('label').textContent, this.checked);
            });
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear stored tokens
                localStorage.removeItem('token');
                sessionStorage.removeItem('token');
                
                // Redirect to login page
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
