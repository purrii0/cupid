<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Discover - Cupid</title>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?display=swap&family=Noto+Sans:wght@400;500;700;900&family=Plus+Jakarta+Sans:wght@400;500;700;800"
  />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="stylesheet" href="assets/styles/main.css" />
  <link rel="stylesheet" href="assets/styles/components.css" />
  <link rel="stylesheet" href="assets/styles/utilities.css" />
</head>

<body
  class="bg-brutalist-dark-pink"
  style='font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'
>
  <div
    class="relative flex size-full min-h-screen flex-col overflow-x-hidden group/design-root"
  >
    <div class="layout-container flex h-full grow flex-col">
      <!-- header -->
      <header class="site-header">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex items-center justify-between py-4">
            <!-- logo -->
            <div class="flex items-center gap-3">
              <h1
                class="text-2xl sm:text-3xl font-black leading-tight tracking-tighter text-black"
              >
                <a
                  href="home.html"
                  class="hover:text-[var(--dark-pink-800)] transition-colors"
                  ><img src="assets/images/logo.png" alt="Cupid Logo" class="h-16 sm:h-20"></a
                >
              </h1>
            </div>

            <!-- desktop navigation -->
            <nav class="hidden md:flex items-center gap-6">
              <a class="nav-link" href="discover.html">Home</a>
              <a class="nav-link" href="swipe.html">Swipe</a>
              <a class="nav-link" href="messages.html">Messages</a>
              <a class="nav-link" href="profile.html">Profile</a>
              <button id="logoutBtn" class="btn-primary">Logout</button>
            </nav>

            <!-- mobile menu button -->
            <div class="md:hidden">
              <button
                id="mobile-menu-toggle"
                class="p-2 text-[var(--dark-pink-800)] hover:text-black"
                aria-label="Toggle menu"
              >
                <svg
                  class="w-6 h-6"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16m-7 6h7"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- mobile menu -->
          <nav
            id="mobile-menu"
            class="md:hidden hidden border-t-2 border-black py-4"
          >
            <div class="flex flex-col gap-4 px-4">
              <a href="login.html" class="btn-secondary inline-block text-center"
                >Login</a
              >
              <a href="signup.html" class="btn-primary inline-block text-center"
                >Sign Up</a
              >
            </div>
          </nav>
        </div>
      </header>

      <!-- main content -->
      <main class="flex-1">
        <!-- page header -->
        <section class="py-8">
          <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            

            <!-- filters -->
            <div class="card p-6 mb-8">
              <h3 class="text-xl font-bold text-black mb-4">Filters</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div>
                  <label
                    class="block text-sm font-semibold text-black mb-2"
                    for="minAge"
                    >Age Range</label
                  >
                  <div class="flex gap-2">
                    <input
                      id="minAge"
                      type="number"
                      placeholder="18"
                      min="18"
                      max="100"
                      class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]"
                    />
                    <span
                      class="flex items-center text-black font-bold"
                      >-</span
                    >
                    <input
                      id="maxAge"
                      type="number"
                      placeholder="35"
                      min="18"
                      max="100"
                      class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]"
                    />
                  </div>
                </div>
                <div>
                  <label
                    class="block text-sm font-semibold text-black mb-2"
                    for="gender"
                    >Gender</label
                  >
                  <select
                    id="gender"
                    class="w-full px-3 py-2 border-2 border-black rounded-none bg-white text-black focus:outline-none focus:border-[var(--dark-pink-500)]"
                  >
                    <option value="all">Choose Gender</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="others">Others</option>
                  </select>
                </div>
                <div class="flex items-end">
                  <button
                    id="applyFiltersBtn"
                    class="w-full btn-primary"
                    type="button"
                  >
                    Apply Filters
                  </button>
                </div>
              </div>
            </div>

            <!-- profile grid -->
            <div
              class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
              id="profileGrid"
            >
              <!-- profiles will be dynamically generated here -->
            </div>

            <!-- load more button -->
            <div class="text-center mt-8">
              <button class="btn-secondary px-8 py-3">Load More Profiles</button>
            </div>
          </div>
        </section>
      </main>

      <!-- footer -->
      <footer
        class="text-center py-6 border-t-2 border-black bg-[var(--dark-pink-200)] bg-opacity-50"
      >
        <p class="text-sm text-[var(--dark-pink-800)]">
          ¬© 2025 Cupid. All rights reserved. Find love, authentically.
        </p>
      </footer>
    </div>
  </div>

  <!-- javascript -->
  <script src="assets/js/main.js"></script>

  <script>
    // Fetch and render users on filter apply
    document
      .getElementById("applyFiltersBtn")
      .addEventListener("click", async () => {
        const minAge =
          parseInt(document.getElementById("minAge").value) || 18;
        const maxAge =
          parseInt(document.getElementById("maxAge").value) || 100;
        const gender = document.getElementById("gender").value || "all";

        // Prepare payload; adjust gender if 'all' means no filter
        const payload = { minAge, maxAge };
        if (gender !== "all") payload.gender = gender;

        try {
          const token = localStorage.getItem("token") || sessionStorage.getItem("token");

          const response = await fetch("http://localhost:8080/getuser", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "authorization": `Bearer ${token}`,
            },
            body: JSON.stringify(payload),
        });


          if (!response.ok) {
            const errorData = await response.json();
            alert(`Error: ${errorData.message || "Failed to fetch users"}`);
            return;
          }

          const data = await response.json();
          const users = data.data || [];

          const profileGrid = document.getElementById("profileGrid");
          profileGrid.innerHTML = ""; // Clear previous profiles

          if (users.length === 0) {
            profileGrid.innerHTML =
              '<p class="text-black text-center col-span-full">No users found matching the filters.</p>';
            return;
          }

       users.forEach((user) => {
  const gender = user.gender;

  const randomNum = Math.floor(Math.random() * 100);

  let photoUrl = '';
  if (gender === 'male') {
    photoUrl = `https://randomuser.me/api/portraits/men/${randomNum}.jpg`;
  } else if (gender === 'female') {
    photoUrl = `https://randomuser.me/api/portraits/women/${randomNum}.jpg`;
  } else {
    photoUrl = 'https://randomuser.me/api/portraits/lego/1.jpg';
  }

  const userCard = `
    <div
      class="profile-card card overflow-hidden hover:shadow-lg transition-shadow cursor-pointer"
    >
      <img
        src="${photoUrl}"
        alt="Profile"
        class="w-full h-64 object-cover"
      />
      <div class="p-4">
        <h3 class="text-lg font-bold text-black mb-1">${user.name || "Unknown"}, ${user.age || ""}</h3>
        <p class="text-sm text-[var(--dark-pink-800)] mb-2">üìç ${user.distance || "N/A"} miles away</p>
        <p class="text-sm text-black mb-3">${user.bio || ""}</p>
        <div class="flex gap-2">
          <button
            class="btn-secondary flex-1 text-sm py-2 view-profile-btn"
            data-userid="${user.id}"
          >
            View Profile
          </button>
          <button class="btn-primary flex-1 text-sm py-2 like-btn">
            üíï Like
          </button>
        </div>
      </div>
    </div>
  `;

  profileGrid.insertAdjacentHTML("beforeend", userCard);
});

          // Add button event listeners dynamically
          profileGrid.querySelectorAll(".view-profile-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
              alert(`Profile view for user id: ${btn.dataset.userid}`);
              // Replace alert with actual profile view navigation/modal
            });
          });

          profileGrid.querySelectorAll(".like-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
              if (btn.textContent.includes("üíï Like")) {
                btn.textContent = "‚úÖ Liked";
                btn.style.backgroundColor = "#4caf50";
              } else {
                btn.textContent = "üíï Like";
                btn.style.backgroundColor = "var(--dark-pink-500)";
              }
            });
          });
        } catch (err) {
          alert("Failed to fetch users. Please try again.");
          console.error(err);
        }
      });

    // Logout button
    document
      .getElementById("logoutBtn")
      .addEventListener("click", function () {
        if (confirm("Are you sure you want to logout?")) {
          localStorage.removeItem("token");
          sessionStorage.removeItem("token");
          window.location.href = "login.html";
        }
      });

    // Mobile menu toggle
    document
      .getElementById("mobile-menu-toggle")
      .addEventListener("click", function () {
        const mobileMenu = document.getElementById("mobile-menu");
        mobileMenu.classList.toggle("hidden");
      });
  </script>
</body>
</html>
